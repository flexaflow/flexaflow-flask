<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Site Settings - Admin</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/admin">Admin Dashboard</a>
            <div>
                <a href="/admin/menu" class="btn btn-outline-light mr-2">Menu Editor</a>
                <a href="/" class="btn btn-outline-light">View Site</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Site Settings</h2>
        
        <div class="card mt-4">
            <div class="card-body">
                <form id="settingsForm">
                    <h4 class="mb-4">General Settings</h4>
                    <div class="form-group">
                        <label>Site Title</label>
                        <input type="text" class="form-control" name="site_title" value="{{ settings.site_title }}">
                    </div>
                    <div class="form-group">
                        <label>Site Description</label>
                        <textarea class="form-control" name="site_description" rows="2">{{ settings.site_description }}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Favicon URL</label>
                        <input type="text" class="form-control" name="favicon" value="{{ settings.favicon }}">
                    </div>
                    <div class="form-group">
                        <label>Logo URL</label>
                        <input type="text" class="form-control" name="logo" value="{{ settings.logo }}">
                    </div>

                    <h4 class="mt-5 mb-4">Important Pages</h4>
                    <div class="form-group">
                        <label>Homepage</label>
                        <select class="form-control" name="homepage">
                            {% for slug, page in pages.items() %}
                            <option value="{{ slug }}" {% if settings.homepage == slug %}selected{% endif %}>{{ page.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Privacy Policy Page</label>
                        <select class="form-control" name="privacy_page">
                            <option value="">None</option>
                            {% for slug, page in pages.items() %}
                            <option value="{{ slug }}" {% if settings.privacy_page == slug %}selected{% endif %}>{{ page.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Terms & Conditions Page</label>
                        <select class="form-control" name="terms_page">
                            <option value="">None</option>
                            {% for slug, page in pages.items() %}
                            <option value="{{ slug }}" {% if settings.terms_page == slug %}selected{% endif %}>{{ page.title }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <h4 class="mt-5 mb-4">Social Media Links</h4>
                    <div class="form-group">
                        <label>Facebook URL</label>
                        <input type="url" class="form-control" name="social_links.facebook" value="{{ settings.social_links.facebook }}">
                    </div>
                    <div class="form-group">
                        <label>Twitter URL</label>
                        <input type="url" class="form-control" name="social_links.twitter" value="{{ settings.social_links.twitter }}">
                    </div>
                    <div class="form-group">
                        <label>Instagram URL</label>
                        <input type="url" class="form-control" name="social_links.instagram" value="{{ settings.social_links.instagram }}">
                    </div>

                    <h4 class="mt-5 mb-4">Analytics</h4>
                    <div class="form-group">
                        <label>Google Analytics ID</label>
                        <input type="text" class="form-control" name="google_analytics" value="{{ settings.google_analytics }}" 
                               placeholder="UA-XXXXXXXXX-X or G-XXXXXXXXXX">
                    </div>

                    <button type="submit" class="btn btn-primary">Save Settings</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        async function callAPI(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                };

                if (data && (method === 'POST' || method === 'PUT' || method === 'DELETE')) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`/api/${endpoint}`, options);

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                alert('API request failed: ' + error.message);
                return null;
            }
        }

        $(document).ready(function() {
            $('#settingsForm').on('submit', async function(e) {
                e.preventDefault();
                
                const formData = {};
                $(this).serializeArray().forEach(item => {
                    if (item.name.includes('.')) {
                        const [parent, child] = item.name.split('.');
                        formData[parent] = formData[parent] || {};
                        formData[parent][child] = item.value;
                    } else {
                        formData[item.name] = item.value;
                    }
                });

                const response = await callAPI('settings', 'POST', formData);
                if (response) {
                    alert('Settings saved successfully!');
                }
            });
        });
    </script>
</body>
</html>